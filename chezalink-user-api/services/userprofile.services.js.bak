const db = require('../db');

// Create a user profile
const createProfile = async (user_name, data) => {
  const {
    first_name,
    last_name,
    bio,
    county,
    date_of_birth,
    account_type,
    prefered_foot,
    position
  } = data;

  const result = await db.query(
    `INSERT INTO profile 
      (user_name, first_name, last_name, bio, county, date_of_birth, account_type, prefered_foot, position)
     VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
     RETURNING *`,
    [
      user_name,
      first_name,
      last_name,
      bio,
      county,
      date_of_birth,
      account_type,
      prefered_foot,
      position
    ]
  );

  return result.rows[0]; // âœ… Let controller send response
};
// Get profile by user_name
const getProfileByUserName = async (user_name) => {
  const result = await db.query('SELECT * FROM profile WHERE user_name = $1', [user_name]);
  return result.rows[0];
};

// Update profile by user_name
// Note: This function assumes that the data object contains only fields that can be updated
const updateProfile = async (user_name, data) => {
  const fields = [];
  const values = [];
  let index = 1;

  for (const key in data) {
    fields.push(`${key} = $${index}`);
    values.push(data[key]);
    index++;
  }

  values.push(user_name);

  const query = `
    UPDATE profile
    SET ${fields.join(', ')}
    WHERE user_name = $${index}
    RETURNING *;
  `;

  const result = await db.query(query, values);
  return result.rows[0];
};

module.exports = {
  createProfile,
  getProfileByUserName,
  updateProfile,
};